<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/indexing-with-blacklab.md at 2021-08-26
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20210826" />
    <meta http-equiv="Content-Language" content="en" />
    <title>BlackLab Core &#x2013; Indexing with BlackLab</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Nunito:300' rel='stylesheet' type='text/css' />
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="http://www.ivdnt.org/" id="bannerLeft"><img src="images/logo_2_ivd-nt_transparant.png"  alt="Dutch Language Institute (INT)"/></a></div>
        <div class="pull-right"><a href="BlackLab/" id="bannerRight"><img src="images/logo-blacklab.png"  alt="BlackLab"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="http://www.ivdnt.org/" class="externalLink" title="INT">INT</a><span class="divider">/</span></li>
      <li class=""><a href="index.html" title="BlackLab">BlackLab</a><span class="divider">/</span></li>
    <li class="active ">Indexing with BlackLab</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2021-08-26</li>
          <li id="projectVersion" class="pull-right">Version: 2.2.0-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">BlackLab</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="learn.html" title="Learn"><span class="icon-chevron-down"></span>Learn</a>
    <ul class="nav nav-list">
    <li><a href="getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="corpus-query-language.html" title="Corpus Query Language"><span class="none"></span>Corpus Query Language</a></li>
    <li><a href="blacklab-server-overview.html" title="BlackLab Server overview"><span class="none"></span>BlackLab Server overview</a></li>
    <li><a href="configuration-files.html" title="Configuration files"><span class="none"></span>Configuration files</a></li>
    <li><a href="blacklab-server-different-languages.html" title="Using BlackLab Server from different languages"><span class="none"></span>Using BlackLab Server from different languages</a></li>
    <li class="active"><a href="#"><span class="none"></span>Indexing with BlackLab</a></li>
    <li><a href="add-input-format.html" title="Add An Input Format"><span class="none"></span>Add An Input Format</a></li>
    <li><a href="improve-search-speed.html" title="Improve Search Speed"><span class="none"></span>Improve Search Speed</a></li>
    <li><a href="apidocs/index.html" title="API reference"><span class="none"></span>API reference</a></li>
    <li><a href="file-formats.html" title="File formats"><span class="none"></span>File formats</a></li>
    </ul>
</li>
    <li><a href="downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="changelog.html" title="Change Log"><span class="none"></span>Change Log</a></li>
    <li><a href="roadmap.html" title="Road Map"><span class="none"></span>Road Map</a></li>
    <li><a href="newsletter.html" title="Newsletter"><span class="none"></span>Newsletter</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Indexing with BlackLab</h1>
<ul>

<li><a href="#index-supported-format">Indexing documents in a supported format</a></li>
<li><a href="#supported-formats">Supported formats</a></li>
<li><a href="#add-custom-format">Add support for your own custom format</a></li>
<li><a href="#using-legacy-docindexers">Using legacy DocIndexers</a>
<ul>

<li><a href="#passing-indexing-parameters">Passing indexing parameters</a></li>
<li><a href="#sensitivity">Configuring case- and diacritics sensitivity per annotation</a></li>
<li><a href="#index-struct">Configuring the index structure</a></li>
<li><a href="#custom-docindexers">Custom DocIndexers</a></li>
<li><a href="#metadata">Metadata</a></li>
</ul>
</li>
<li><a href="#edit-index-metadata">Editing the index metadata</a></li>
</ul>
<p><a name="index-supported-format" id="index-supported-format"></a></p>
<div class="section">
<h2><a name="Indexing_documents_in_a_supported_format"></a>Indexing documents in a supported format</h2>
<p>Get the blacklab JAR and the required libraries (see <a href="getting-started.html#getting-blacklab">Getting started</a>). The libraries should be in a directory called &#x201c;lib&#x201d; that&#x2019;s in the same directory as the BlackLab JAR (or elsewhere on the classpath).</p>
<p>Start the IndexTool without parameters for help information:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar&quot; nl.inl.blacklab.tools.IndexTool
</pre></div></div>

<p>(this assumes blacklab.jar and the lib subdirectory containing required libraries are located in the current directory)</p>
<p>(if you&#x2019;re on Windows, replace the classpath separator colon (:) with a semicolon (;))</p>
<p>To create a new index:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar&quot; nl.inl.blacklab.tools.IndexTool create INDEX_DIR INPUT_FILES FORMAT
</pre></div></div>

<p>To add documents to an existing index:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar&quot; nl.inl.blacklab.tools.IndexTool add INDEX_DIR INPUT_FILES FORMAT
</pre></div></div>

<p>If you specify a directory as the INPUT_FILES, it will be scanned recursively. You can also specify a file glob (such as *.xml; single-quote it if you&#x2019;re on Linux so it doesn&#x2019;t get expanded by the shell) or a single file. If you specify a .zip or .tar.gz file, BlackLab will automatically index the contents.</p>
<p>For example, if you have TEI data in /tmp/my-tei/ and want to create an index as a subdirectory of the current directory called &#x201c;test-index&#x201d;, run the following command:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar&quot; nl.inl.blacklab.tools.IndexTool create test-index /tmp/my-tei/ tei
</pre></div></div>

<p>Your data is indexed and placed in a new BlackLab index in the &#x201c;test-index&#x201d; directory.</p>
<p>NOTE: if you don&#x2019;t specify a glob, IndexTool will index *.xml by default. You can specify a glob (like &#x201c;*.txt&#x201d; or &#x201c;*&#x201d; for all files) to change this.</p>
<p>Also, please note that if you&#x2019;re indexing large files, you should <a class="externalLink" href="https://docs.oracle.com/cd/E15523_01/web.1111/e13814/jvm_tuning.htm#PERFM161">give java more than the default heap memory</a>, using the <tt>-Xmx</tt> option. For really large files, and if you have the memory, you could use <tt>-Xmx 6G</tt>, for example.</p>
<p>To delete documents from an index:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar&quot; nl.inl.blacklab.tools.IndexTool delete INDEX_DIR FILTER_QUERY
</pre></div></div>

<p>Here, FILTER_QUERY is a metadata filter query in Lucene query language that matches the documents to delete. Deleting documents and re-adding them can be used to update documents.</p>
<p><a name="supported-formats" id="supported-formats"></a></p></div>
<div class="section">
<h2><a name="Supported_formats"></a>Supported formats</h2>
<p>BlackLab supports a number of input formats that are common in corpus linguistics:</p>
<ul>

<li>tei (<a class="externalLink" href="http://www.tei-c.org/">Text Encoding Initiative</a>, a popular XML format for linguistic resources, including corpora. indexes content inside the &#x2018;body&#x2019; element; assumes part of speech is found in an attribute called &#x2018;type&#x2019;)</li>
<li>sketch-wpl (the TSV/XML hybrid input <a class="externalLink" href="https://www.sketchengine.co.uk/documentation/preparing-corpus-text/">format the Sketch Engine/CWB use</a>)</li>
<li>chat (<a class="externalLink" href="https://en.wikipedia.org/wiki/CHILDES#Database_Format">Codes for the Human Analysis of Transcripts</a>, the format used by the CHILDES project)</li>
<li>folia (a <a class="externalLink" href="https://proycon.github.io/folia/">corpus XML format</a> popular in the Netherlands)</li>
<li>tsv-frog (tab-separated file as produced by the <a class="externalLink" href="https://languagemachines.github.io/frog/">Frog annotation tool</a>)</li>
</ul>
<p>BlackLab also supports these generic file formats:</p>
<ul>

<li>csv (Comma-Separated Values file that should have column names &#x201c;word&#x201d;, &#x201c;lemma&#x201d; and &#x201c;pos&#x201d;)</li>
<li>tsv (Tab-Separated Values file that should have column names &#x201c;word&#x201d;, &#x201c;lemma&#x201d; and &#x201c;pos&#x201d;)</li>
<li>txt (A plain text file; will tokenize on whitespace and index word forms)</li>
</ul>
<p>A number of less common formats are also supported:</p>
<ul>

<li>pagexml (OCR XML format)</li>
<li>alto (<a class="externalLink" href="http://www.loc.gov/standards/alto/">an OCR XML format</a>)</li>
<li>whitelab2 (FoLiA format, but specifically tailored for the <a class="externalLink" href="https://github.com/Taalmonsters/WhiteLab2.0">WhiteLab2</a> search frontend)</li>
<li>sketchxml (files converted from the Sketch Engine&#x2019;s tab-separated format to be &#x201c;true XML&#x201d;, so each token corresponds to a &#x2018;w&#x2019; tag)</li>
<li>di-tei-element-text (a variant of TEI where content inside the &#x2018;text&#x2019; element is indexed)</li>
<li>di-tei-pos-function (a variant of TEI where part of speech is in an attribute called &#x2018;function&#x2019;)</li>
</ul>
<p>To add support for your own format, you just have to <a href="how-to-configure-indexing.html">write a configuration file</a>. (There&#x2019;s a <a href="#using-legacy-docindexers">legacy way</a> too, but that involves writing Java code and you probably don&#x2019;t need it) Please <a class="externalLink" href="mailto:jan.niestadt@ivdnt.org">contact us</a> if you have any questions.</p>
<p>If you choose the first option, specify the format name (which must match the name of the .blf.yaml or .blf.json file) as the FORMAT parameter. IndexTool will search a number of directories, including the current directory and the (parent of the) input directory for format files.</p>
<p>If you choose the second option, specify the fully-qualified class name of your DocIndexer class as the FORMAT parameter.</p>
<p><a name="add-custom-format" id="add-custom-format"></a></p></div>
<div class="section">
<h2><a name="Add_support_for_your_own_custom_format"></a>Add support for your own custom format</h2>
<p>There&#x2019;s two approaches to adding support for a new input format in BlackLab. The preferred one starting from BlackLab 1.7.0 is to write an input format configuration file in either YAML or JSON format. See <a href="how-to-configure-indexing.html">How to configure indexing</a>.</p>
<p>The other way is considered somewhat legacy, although it may still be useful in rare cases. It offers slightly (i.e. likely less than 50%) better performance and complete control over the indexing process. This is documented below. You&#x2019;re probably better off with the configuration file approach, though.</p>
<p><a name="using-legacy-docindexers" id="using-legacy-docindexers"></a></p></div>
<div class="section">
<h2><a name="Using_legacy_DocIndexers"></a>Using legacy DocIndexers</h2>
<p><a name="passing-indexing-parameters" id="passing-indexing-parameters"></a></p>
<div class="section">
<h3><a name="Passing_indexing_parameters"></a>Passing indexing parameters</h3>
<p>You can pass parameters to the DocIndexer class to customize its indexing process. This can be done in two ways: as options on the IndexTool command line, or via a properties file.</p>
<p>(if you use a <a href="how-to-configure-indexing.html">configuration file</a> to index your files, you don&#x2019;t need this)</p>
<p>To pass a parameter as an option on the command line, use three dashes, like this:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar:lib/*&quot; nl.inl.blacklab.tools.IndexTool create ---PARAMNAME PARAMVALUE ...
</pre></div></div>

<p>To pass parameters via a property file, use the &#x2013;indexparam option:</p>

<div>
<div>
<pre class="source">java -cp &quot;blacklab.jar:lib/*&quot; nl.inl.blacklab.tools.IndexTool create --indexparam PROPERTYFILE ...
</pre></div></div>

<p>NOTE: in addition to the &#x2013;indexparam parameter, IndexTool will always look for a file named indexer.properties in the current directory, the input directory, the parent of the input directory, or the index directory. If the file is found in any of these locations, it is read and the values are used as indexing parameters.</p>
<p>Use the DocIndexer.getParameter(name[, defaultValue]) method to retrieve parameters inside your DocIndexer. For an example of using DocIndexer parameters, see the DocIndexerTeiBase and MetadataFetcherSonarCmdi in the nl.inl.blacklab.indexers package. They use parameters to configure annotation names and where to fetch metadata from, respectively.</p>
<p>Configuring an external metadata fetcher (see &#x201c;Metadata from an external source&#x201d; below) and case- and diacritics sensitivity (see next section) is also done using a indexing parameter for now. Note that this parameter passing mechanism predates the index structure file (see &#x201c;Configuring the index structure&#x201d; below) and is likely to be deprecated in favour of that in future versions.</p>
<p><a name="sensitivity" id="sensitivity"></a></p></div>
<div class="section">
<h3><a name="Configuring_case-_and_diacritics_sensitivity_per_annotation"></a>Configuring case- and diacritics sensitivity per annotation</h3>
<p>(if you use a <a href="how-to-configure-indexing.html">configuration file</a> to index your files, you can specify this there)</p>
<p>You can also configure what &#x201c;sensitivity alternatives&#x201d; (case/diacritics sensitivity) to index for each annotation, using the &#x201c;PROPNAME_sensitivity&#x201d; parameter. Accepted values are &#x201c;i&#x201d; (both only insensitive), &#x201c;s&#x201d; (both only sensitive), &#x201c;si&#x201d; (sensitive and insensitive) and &#x201c;all&#x201d; (case/diacritics sensitive and insensitive, so 4 alternatives). What alternatives are indexed determines how specifically you can specify the desired sensitivity when searching.</p>
<p>If you don&#x2019;t configure these, BlackLab will pick (hopefully) sane defaults (i.e. word/lemma get &#x201c;si&#x201d;, punct gets &#x201c;i&#x201d;, starttag gets &#x201c;s&#x201d;, others get &#x201c;i&#x201d;).</p>
<p><a name="index-struct" id="index-struct"></a></p></div>
<div class="section">
<h3><a name="Configuring_the_index_structure"></a>Configuring the index structure</h3>
<p>(if you use a <a href="how-to-configure-indexing.html">configuration file</a> to index your files, you can specify all these settings there, so you don&#x2019;t need a separate index structure file)</p>
<p>What we call the &#x201c;index structure&#x201d; consists of some top-level index information (name, description, etc.), what word-level annotations (formerly called &#x201c;properties&#x201d;) you want to index, what metadata fields there are and how they should be indexed, and more.</p>
<p>By default, a default index structure is determined by BlackLab and the DocIndexer you&#x2019;re using. However, you can influence exactly how your index is created using a customized index structure file. If you specify such an index structure file when creating the index, it will be used as a template for the index metadata file, and so you won&#x2019;t have to specify the index structure file again when updating your index later; all the information is now in the index metadata file. It is possible to edit the index metadata file manually as well, but use caution, because it might break something.</p>
<p>To use a custom indextemplate.yaml or indextemplate.json when creating an index, make sure the file is present either in the input directory, or in the parent directory of the input directory. IndexTool will automatically detect and use it. The resulting index metadata file will be saved in the index directory.</p>
<p>There&#x2019;s a <a href="how-to-configure-indexing.html#edit-index-metadata">commented example of indexstructure.yaml</a>.</p>
<p><a name="disable-fi" id="disable-fi"></a></p>
<p>Please note: the settings pidField, titleField, authorField, dateField refer to the name of the field in the Lucene index, not an XML element name.</p></div>
<div class="section">
<h3><a name="When_and_how_to_disable_the_forward_index_for_an_annotation"></a>When and how to disable the forward index for an annotation</h3>
<p>(if you use a <a href="how-to-configure-indexing.html">configuration file</a> to index your files, you can specify this there)</p>
<p>By default, all properties get a forward index. The forward index is the complement to Lucene&#x2019;s reverse index, and can quickly answer the question &#x201c;what value appears in position X of document Y?&#x201d;. This functionality is used to generate snippets (such as for keyword-in-context (KWIC) views), to sort and group based on context words (such as sorting on the word left of the hit) and will in the future be used to speed up certain query types.</p>
<p>However, forward indices take up a lot of disk space and can take up a lot of memory, and they are not always needed for every annotation. You should probably have a forward index for at least the word and punct annotations, and for any annotation you&#x2019;d like to sort/group on or that you use heavily in searching, or that you&#x2019;d like to display in KWIC views. But if you add an annotation that is only used in certain special cases, you can decide to disable the forward index for that annotation. You can do this by adding the annotation name to the &#x201c;noForwardIndexProps&#x201d; space-separated list in the indextemplate.json file shown above.</p>
<p>A note about forward indices and indexing multiple values at a single corpus position: as of right now, the forward index will only store the first value indexed at any position. We would like to expand this so that it is possible to quickly retrieve all values indexed at a corpus position, but that is not the case now.</p>
<p>Note that if you want KWICs or snippets that include annotations without a forward index (as well the rest of the original XML), you can switch to using the original XML to generate KWICs and snippets, at the cost of speed. To do this, pass usecontent=orig to BlackLab Server, or call Hits.settings().setConcordanceType(ConcordanceType.CONTENT_STORE).</p>
<p><a name="custom-docindexers" id="custom-docindexers"></a></p></div>
<div class="section">
<h3><a name="Custom_DocIndexers"></a>Custom DocIndexers</h3>
<p><a name="word-annotated" id="word-annotated"></a></p>
<div class="section">
<h4><a name="Indexing_word-annotated_XML"></a>Indexing word-annotated XML</h4>
<p>NOTE: an easier way of doing this is to <a href="how-to-configure-indexing.html">write a configuration file</a> instead of Java code.</p>
<p>If you really want to implement your own DocIndexer class, see this <a href="add-input-format.html">example</a>.</p>
<p>If you have an XML format in which each word has its own XML tag, containing any annotations, you should derive your DocIndexer class from DocIndexerXmlHandlers. This class allows you to add &#x2018;hooks&#x2019; for handling different XML elements.</p>
<p>The constructor of your indexing class should call the superclass constructor, declare any annotations (e.g. lemma, pos) you&#x2019;re going to index and finally add hooks (called handlers) for each XML element you want to do something with.</p>
<p>Declaring annotations (formerly called &#x201c;properties&#x201d; in BlackLab) is done using the DocIndexerXmlHandlers.addAnnotation(String). Store the result in a final variable so you can access it from your custom handlers. Note that the &#x201c;main annotation&#x201d; (usually called &#x201c;word&#x201d;) and the &#x201c;punct&#x201d; annotation (whitespace and punctuation between words) have already been created by DocIndexerXmlHandlers; retrieve them using the mainAnnotation() and punctAnnotation() methods.</p>
<p>Adding a handler is done using the DocIndexerXmlHandlers.addHandler(String, ElementHandler) method. The first parameter is an xpath-like expression that indicates the element to handle. The expression looks like xpath but is very limited: only element names separated by slashes; it may start with either a single (absolute path) or a double (relative path) slash. DocIndexerXmlHandlers defines several default ElementHandlers: ElementHandler (does nothing but keep track of whether we&#x2019;re inside this element), DocumentElementHandler (creates and adds document to the index), several metadata handlers that deal with different types of metadata elements (assuming the document contains its own metadata - see below for external metadata), InlineTagHandler (adds inline tags from the content to the index, such as &lt;p&gt;, &lt;s&gt; (sentence), &lt;b&gt;), several word handlers (indexes words and whitespace/punctuation between words). You can also easily create or derive your own, usually as an anonymous inner class that overrides the startElement() and endElement() methods.</p>
<p>You need to add a handler for your document element (signifying the start and end of your logical documents; probably just use DocumentElementHandler), your word element (signifying a word to index; probably derive from WordHandlerBase), and any inline tags you wish to index (probably just use InlineTagHandler). Optionally, you may want to add a simple ElementHandler for your &#x201c;body&#x201d; tag, if you wish to restrict what part of the document is actually indexed; in this case, you should expand your word and inline tag handlers to check that you&#x2019;re inside this body element before processing the matched element.</p>
<p>A word handler derived from DefaultWordHandler might retrieve lemma and part of speech from the attributes of the start tag and add them to the annotations you declared at the top of your DocIndexer-constructor. You can do this using the AnnotationWriter.addValue() method. DefaultWordHandler takes care of adding values to the standard annotations word and punct. For this, DefaultWordHandler assumes the word is simply the word element&#x2019;s text content. DefaultWordHandler also stores the character positions before and after the word (which are needed if you want to highlight in the original XML).</p>
<p>An important note about adding values to annotations: it is crucial that you call AnnotationWriter.addValue() to each annotation an equal number of times! Each time you call addValue(), you move that annotation to the next corpus position, but other annotations do not automatically move to the next corpus position; it is up to you to make sure all annotations stay at the same corpus position. If a annotation has no value at a certain position, just add an empty string.</p>
<p>You should probably call consumeCharacterContent(), which clears the buffer of captured text content in the document, at the start of a document (or at the start of the body element, if you handle that separately). This prevents the first punct value containing already captured text content you don&#x2019;t want. Similarly, before storing the document, you should add one last punct value (using consumeCharacterContent() to get the value to store), so the last bit of whitespace/punctuation isn&#x2019;t skipped. BlackLab assumes that there&#x2019;s always an extra &#x201c;dummy&#x201d; token containing only the last bit of whitespace/punctuation.</p>
<p>The <a href="add-input-format.html">tutorial</a> develops a simple TEI DocIndexer using the above techniques.</p>
<p><a name="multiple-values" id="multiple-values"></a></p></div>
<div class="section">
<h4><a name="Multiple_values_at_one_position.2C_position_gaps_and_adding_annotation_values_at_an_earlier_position"></a>Multiple values at one position, position gaps and adding annotation values at an earlier position</h4>
<p>NOTE: this applies if you&#x2019;re implementing your own DocIndexer class. The other appraoch, using a <a href="how-to-configure-indexing.html">configuration file</a>, does support standoff annotations but has no support for multiple values at one position (yet). Please let us know if you need this.</p>
<p>The AnnotationWriter.addValue(String) method adds a value to an annotation at the next corpus position. Sometimes you may want to add multiple values at a single corpus position, or you may want to skip a number of corpus positions. This can be done using the AnnotationWriter.addValue(String, Integer) method; the second parameter is the increment compared to the previous value. The default value for the increment is 1, meaning each value is indexed at the next corpus position.</p>
<p>To add multiple values to a single corpus position, only use the default increment of 1 for the first value you want to add at this position; for all subsequent values at this position, use an increment of 0. Note: if the value you added first was the empty string, adding the next value with an increment of 0 will overwrite this empty string. This can be convenient if you&#x2019;re not sure whether you want to add any values at a particular location, but you want to make sure the annotation stays at the correct corpus position regardless.</p>
<p>To skip a number of corpus positions when adding a value, use an increment that is higher than 1. So to skip one position (and therefore leave a &#x201c;gap&#x201d; one wide), use an increment of 2.</p>
<p>Finally, you may sometimes wish to add values to an earlier corpus position. Say you&#x2019;re at position 100, and you want to add a value to position 50. You can do so using the AnnotationWriter.addValueAtPosition(String, Integer) method. The first token has position 0.</p>
<p><a name="subproperties" id="subproperties"></a></p></div>
<div class="section">
<h4><a name="Subannotations.2C_for_e.g._making_part_of_speech_features_separately_searchable_.28EXPERIMENTAL.29"></a>Subannotations, for e.g. making part of speech features separately searchable (EXPERIMENTAL)</h4>
<p>(you should use a <a href="how-to-configure-indexing.html">configuration file</a> for this)</p>
<p><a name="payloads" id="payloads"></a></p></div>
<div class="section">
<h4><a name="Storing_extra_information_with_annotation_values.2C_using_payloads"></a>Storing extra information with annotation values, using payloads</h4>
<p>(the <a href="how-to-configure-indexing.html">configuration file</a> approach does not support this yet; let us know if you need this)</p>
<p>It is possible to add payloads to annotation values. When calling addAnnotation() at the start of the constructor, make sure to use the version that takes a boolean called &#x2018;includePayloads&#x2019;, and set it to true. Then use AnnotationWriter.addPayload(). You can use null if a particular value has no payload. There&#x2019;s also a addPayloadAtIndex() method to add payloads some time after adding the value itself, but that requires knowing the index in the value list of the value you want to add a payload for, so you should store this index when you add the value.</p>
<p>One example of using payloads can be seen in DocIndexerXmlHandlers.InlineTagHandler. When you use InlineTagHandler to index an inline element, say a sentence tag, BlackLab will add a value (or several values, if the element has attributes) to the built-in &#x2018;starttag&#x2019; annotation. When it encounters the end tag, it wil update the start tag value with a payload indication the element length. This is used when searching to determine what matches occur inside certain XML tags.</p>
<p><a name="nonxml" id="nonxml"></a></p></div>
<div class="section">
<h4><a name="Indexing_non-XML_file_types"></a>Indexing non-XML file types</h4>
<p>(the <a href="how-to-configure-indexing.html">configuration file</a> approach directly supports tabular (CSV/TSV) input formats and the plain text input format)</p>
<p>If your input files are not XML or are not tokenized and annotated per word, you have two options: convert them into a tokenized, per-word annotated format, or index them directly.</p>
<p>Indexing them directly is not covered here, but involves deriving from DocIndexerAbstract or implementing the DocIndexer interface yourself. If you need help with this, please <a class="externalLink" href="mailto:jan.niestadt@ivdnt.org">contact us</a>.</p>
<p><a name="metadata" id="metadata"></a></p></div></div>
<div class="section">
<h3><a name="Metadata"></a>Metadata</h3>
<p><a name="metadata-in-document" id="metadata-in-document"></a></p>
<div class="section">
<h4><a name="In-document_metadata"></a>In-document metadata</h4>
<p>(the <a href="how-to-configure-indexing.html">configuration file</a> support this directly)</p>
<p>Some documents contain metadata within the document. You usually want to index these as fields with your document, so you can filter on them later. You do this by adding a handler for the appropriate XML element.</p>
<p>There&#x2019;s a few helper classes for in-document metadata handling. MetadataElementHandler assumes the matched element name is the name of your metadata field and the character content is the value. MetadataAttributesHandler stores all the attributes from the matched element as metadata fields. MetadataNameValueAttributeHandler assumes the matched element has a name attribute and a value attribute (the attribute names can be specified in the constructor) and stores those as metadata fields. You can of course easily add your own handler classes to this if they don&#x2019;t suit your particular style of metadata (have a look at nl.inl.blacklab.index.DocIndexerXmlHandlers.java to see how the predefined ones are implemented).</p>
<p><a name="metadata-external" id="metadata-external"></a></p></div>
<div class="section">
<h4><a name="Metadata_from_an_external_source"></a>Metadata from an external source</h4>
<p>(the <a href="how-to-configure-indexing.html">configuration file</a> support this directly)</p>
<p>Sometimes, documents link to external metadata sources, usually using an ID.</p>
<p>The MetadataFetcher is instantiated by DocIndexerXmlHandlers.getMetadataFetcher(), based on the metadataFetcherClass indexer parameter (see &#x201c;Passing indexing parameters&#x201d; above). This class is instantiated with the DocIndexer as a parameter, and the addMetadata() method is called just before adding a document to the index. Your particular MetadataFetcher can inspect the document to find the appropriate ID, fetch the metadata (e.g. from a file, database or webservice) and add it to the document using the DocIndexerXmlHandlers.addMetadataField() method.</p>
<p>Also see the two MetadataFetcher examples in nl.inl.blacklab.indexers.</p>
<p><a name="fixed-metadata-field" id="fixed-metadata-field"></a></p></div>
<div class="section">
<h4><a name="Add_a_fixed_metadata_field_to_each_document"></a>Add a fixed metadata field to each document</h4>
<p>(the <a href="how-to-configure-indexing.html">configuration file</a> support this directly)</p>
<p>It is possible to tell IndexTool to add a metadata field with a specific value to each document indexed. An example of when this is useful is if you wish to combine several corpora into a single index, and wish to distinguish documents from the different corpora using this metadata field. You would achieve this by running IndexTool twice: once to create the index and add the documents from the first corpus, &#x201c;tagging&#x201d; them with a field named e.g. Corpus_title (which is the fieldname <a class="externalLink" href="https://github.com/Taalmonsters/WhiteLab2.0">Whitelab</a> expects) with an appropriate value indicating the first corpus. Then you would run IndexTool again, with command &#x201c;append&#x201d; to append documents to the existing index, and giving Corpus_title a different value for this set of documents.</p>
<p>There&#x2019;s two ways to add this fixed metadata field for an IndexTool run. One is to pass an option &quot;&#x2014;meta-Corpus_title mycorpusname&quot; (note the 3 dashes!) to the IndexTool. The other is to place a property &quot;meta-Corpus_title=mycorpusname&quot; in a file called indexer.properties in the current directory. This file can be used for other per-run IndexTool configuration; see below.</p></div>
<div class="section">
<h4><a name="Controlling_how_metadata_is_fetched_and_indexed"></a>Controlling how metadata is fetched and indexed</h4>
<p>(the <a href="how-to-configure-indexing.html">configuration file</a> support this directly)</p>
<p>By default, metadata fields are tokenized, but it can sometimes be useful to index a metadata field without tokenizing it. One example of this is a field containing the document id: if your document ids contain characters that normally would indicate a token boundary, like a period (.) , your document id would be split into several tokens, which is usually not what you want. Use the indextemplate.json file (described above) to indicate you don&#x2019;t want a metadata field to be tokenized.</p>
<p><a name="edit-index-metadata" id="edit-index-metadata"></a></p></div></div></div>
<div class="section">
<h2><a name="Editing_the_index_metadata"></a>Editing the index metadata</h2>
<p>NOTE: it is best to <a href="how-to-configure-indexing.html#influence-index-metadata">influence the index metadata</a> through your input format configuration file. That way, re-indexing your data doesn&#x2019;t overwrite your changes.</p>
<p>In addition to specifying this information in your input format configuration file as described above, it is also possible to edit the index metadata file manually. If you do this, be careful, because it might break something. It is best to use a text editor with support for YAML, and to validate the resulting file with a YAML validator such as <a class="externalLink" href="http://www.yamllint.com/">YAML Lint</a>. Also remember that if you edit the index metadata file, and you later decide to generate a new index from scratch, your changes to the metadata file will be lost. If possible, it is therefore preferable to put this information in the input format configuration file directly. (If you find that this is not possible in your case, please let us know.)</p>
<p>Here&#x2019;s a commented example of indexmetadata.yaml:</p>

<div>
<div>
<pre class="source">---
# Display name for the index and short description
# (not used by BlackLab. None of the display name or description values
#  are used by BlackLab directly, but applications can retrieve them if they want)
displayName: OpenSonar
description: The OpenSonar corpus.

# What was the name of the input format first added to this index?
# (it is possible to add documents of different formats to the same index,
#  so this is not a guarantee that all documents have this format)
documentFormat: OpenSonarFolia

# Total number of tokens in this corpus.
tokenCount: 12345

# Information about the index format and when and how it was created
# (don't change this)
versionInfo:
  blackLabBuildTime: &quot;2017-08-01 00:00:00&quot;
  blackLabVersion: &quot;1.7.0&quot;
  indexFormat: &quot;3.1&quot;
  timeCreated: &quot;2017-07-31 16:03:37&quot;
  timeModified: &quot;2017-07-31 16:03:37&quot;
  alwaysAddClosingToken: true
  tagLengthInPayload: true

# Information about annotated (complex) and metadata fields
fieldInfo:
  titleField: title            # ((optional, detected if omitted); field in the index containing
                               #  document title; may be used by applications)
  authorField: author          # ((optional) field in the index containing author information;
                               #  may be used by applications)
  dateField: date              # ((optional) field in the index containing document date 
                               #  information; may be used by applications)
  pidField: id                 # ((optional, recommended) field in the index containing unique 
                               #  document id; may be used by applications to refer to documents;
                               #  may be used by BlackLab to directly update documents without 
                               #  the client having to manually delete the previous version)
  defaultAnalyzerName: DEFAULT # The type of analyzer to use for metadata fields
                               # by default (DEFAULT|whitespace|standard|nontokenizing)
  contentViewable: false       # is the user allowed to retrieve whole documents? 
  textDirection: LTR           # text direction of the corpus (e.g. LTR/RTL) (not used by BlackLab) 
  documentFormat: ''           # (not used by BlackLab. may be used by application to 
                               #  e.g. select which XSLT to use)
  unknownValue: unknown        # what value to index if field value is unknown [unknown]
  unknownCondition: NEVER      # When is a field value considered unknown?
                               # (other options: MISSING, EMPTY, MISSING_OR_EMPTY) [NEVER]
  
  # Information about specific metadata fields
  metadataFields:
  
    # Information about the author field
    author:
      displayName: author                      # (optional) How to display in interface
      description: The author of the document. # (optional) Description (e.g. tooltip) in interface
      type: tokenized                          # ..or text, numeric, untokenized [tokenized]
      analyzer: default                        # ..(or whitespace|standard|nontokenizing) [default]
      unknownValue: unknown                    # overrides default unknownValue for this field
      unknownCondition: MISSING_OR_EMPTY       # overrides default unknownCondition for this field
      uiType: select                           # (optional) Widget to use in interface (text|select|range)
      values:                                  # values indexed in this field
      - firstValue
      - secondValue
      valueListComplete: true                  # are all values listed here, or just a few (max. 50)?
      displayValues:                           # (optional) How to display certain values in this field
        tolkien: J.R.R. Tolkien                #   e.g. display value &quot;tolkien&quot; as &quot;J.R.R. Tolkien&quot;
        adams: Douglas Adams
      displayOrder:                            # (optional) Specific order to display values in
      - tolkien
      - adams
  
  # (optional)
  # This block allows you to define groups of metadata fields.
  # BlackLab Server will include this information on the index structure page.
  # This can be useful if you want to generate a user interface based on index metadata. 
  metadataFieldGroups:
  - name: First group
    fields:
    - author
    - title
  - name: Second group
    fields:
    - date
    - keywords
    addRemainingFields: true  # plus any fields that weren't mentioned yet 
    
  # Information about annotated fields (formerly called &quot;complex fields&quot; in BlackLab)
  complexFields:
  
    # Information about the contents field
    contents:
      mainProperty: word         # main annotation. used for concordances; contains char. offsets
      displayName: contents      # (optional) how to display in GUI
      description: The text contents of the document.
      noForwardIndexProps: ''    # (optional) space-separated list of annotation (property)
                                 # names that shouldn't get a forward index
      displayOrder:              # (optional) Order to display annotation search fields
      - word
      - lemma
      - pos
</pre></div></div>

<p>Please note: the settings pidField, titleField, authorField, dateField refer to the name of the field in the Lucene index, not an XML element name.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2021
<a href="https://www.ivdnt.org/">Instituut voor Nederlandse Taal (INT)</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
